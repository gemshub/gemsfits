<!DOCTYPE html>
<html>
  <head>
    <meta content="text/html; charset=windows-1252" http-equiv="content-type">
    <title>gfshell Databse Mode</title>
  </head>
  <body style="               background-image: url(bgimg-gray.jpg);">
    <h1> <img style="width: 48px; height: 48px;" title="GEMSFITS" alt="GEMSFITS"
        src="DatabaseModeIcon.png"> GEMSFITS Code for GEM Input Parameter
      Optimization</h1>
    <h2>gfshell Database Mode</h2>
    <hr>
    <p> The CRUD (Create, Read, Update, Delete) operations can be done directly
      in the database using the EJDB console (http://ejdb.org) or using the
      gfshell GUI menus and the JSON data editor. The latter allows also for
      exporting the data into JSON (csv and YSON in future releases) format
      files. YSON is a subset of YAML – a data serialization format
      (http://yaml.org), even human-friendlier than JSON (http://json.org).</p>
    <p>In the Database Mode, the experimental records from the project database
      can be viewed in a list and edited in <a title="JSON" href="gemsfit-json.html">JSON
        format</a>. Bulk data can be backed up and restored form <a title="JSON"
        href="gemsfit-json.html">JSON format</a> files or imported and exported
      <a title="csvtoejdb" href="gemsfit-csvtoejdb.html">from preformatted
        spreadsheets</a> files previously saved in csv format. The database
      selection queries can be added and edited in the “Search Query Editor”.
      The record (sample) list resulted by executing the search query can be
      then easily exported into the task specification with help of a menu
      command,&nbsp; to be used during the fitting run. </p>
    <p> </p>
    <h3>Contents</h3>
    <ul>
      <li><a href="#manage_data">Manage bulk data (import/export)</a></li>
      <li><a href="#crud">CRUD (Create, Read, Update, Delete) on database
          records</a></li>
      <li><a href="#search">Search queries</a></li>
    </ul>
    <hr>
    <h3><a id="manage_data">1. Manage bulk data (import/export)</a></h3>
    <p> Allows importing large amount of experimental data form <a href="howto-csvtoejdb.html">preformated
        csv files</a> or from <a href="gemsfit-json.html">JSON</a> files&nbsp;
      (e.g. previously backed-up files). To overwrite existing data activated: <span
        style="text-decoration: underline; font-weight: bold;">D</span><span style="font-weight: bold;">atabase</span><span
        style="font-weight: bold;"> -&gt; Overwrite</span>. Only unique <a style="font-family: Courier New,Courier,monospace;"
        href="gemsfit-useref.html#expdataset">"expdataset"</a>-<a style="font-family: Courier New,Courier,monospace;"
        href="gemsfit-useref.html#sample">"sample"</a> name pairs are allowed.</p>
    <p> Prepare the <a href="howto-csvtoejdb.html#1._Prepare_your_data_">preformated
        CSV file (comma separated value)</a>.</p>
    <p> </p>
    <p> a. To import data from <a href="howto-csvtoejdb.html#1._Prepare_your_data_">preformated
        csv files</a>: <span style="font-weight: bold;">Database -&gt; Import
        data from CSV file... -&gt;</span> Select the path to the file (default
      <span style="font-weight: bold;">/dbimport</span> sub-folder of the
      project folder).</p>
    <p><a name="distinctTP.csv"></a>Anytime when you import data a file
      terminated in <span style="font-family: Courier New,Courier,monospace;">..._distinctTP.csv</span>
      is created. This file contains the unique temperature-pressure points of
      all experiments present in the database. The unique T-P points are needed
      when exporting the chemical system definition (<span style="font-family: Courier New,Courier,monospace;">GEMS3K</span>)&nbsp;
      files (to have the complete array of thermodynamic properties at all
      possible pressure and temperature conditions of the experiments).<br>
    </p>
    <p>b. To backup the data in JSON format file: <span style="font-weight: bold;">Database
        -&gt; Backup data in JSON file... -&gt;</span> Select which entries to
      backup -&gt; Chose path and file name *.json. These files are compatible
      and can be imported on an <a target="_blank" title="MongoDB" href="http://www.mongodb.org/">MongoDB
        databse</a> server.<br>
    </p>
    <p>c. To restore data from JSON file: <span style="font-weight: bold;">Database
        -&gt; Restore data from JSON file... -&gt;</span> Select the path to the
      file.</p>
    <hr>
    <h3><a id="crud">2. CRUD (Create, Read, Update, Delete)</a></h3>
    <p> All records and changes have to be in valid JSON format. This can be
      tested using the <span style="font-weight: bold;">Test JSON format</span>
      <img style="width: 24px; height: 24px;" alt="Test JSON fromat" title="Test JSON fromat"
        src="img/CalculateBCCIcon24.png">. </p>
    <p>a. Create new record by template. A new database record using a
      predefined JSON template is created. The record template is set from: <span
        style="font-weight: bold;">Help -&gt; Preferences:</span> <span style="font-weight: bold;">Settings:</span>
      Select template file for experiments record. A new record template is
      created using the <span style="font-weight: bold;">Create new by template</span>
      <img style="width: 24px; height: 24px;" alt="Create New by template" title="Create New by template"
        src="img/NewCreateRecordIcon24.png">. The user has then to <a href="gemsfit-useref.html">edit
        the record</a> to describe the desired experimental details. To insert
      the new data click the <span style="font-weight: bold;">Insert new record</span>
      <img style="width: 24px; height: 24px;" alt="Insert new record" title="Insert new record"
        src="img/NewCloneRecordIcon24.png">. </p>
    <p>b. Update exiting records. Make the desired changes (e.g. change the
      amount of components) in valid JSON format. To save the changes click <span
        style="font-weight: bold;">Update current record</span> <img style="width: 24px; height: 24px;"
        alt="Update current record" title="Update current record" src="img/SaveCurrentRecordIcon24.png">.
    </p>
    <p>c. Delete exiting records with <span style="font-weight: bold;">Delete
        current record</span> <img style="width: 24px; height: 24px;" alt="Delete current record"
        title="Delete current record" src="img/DeleteCurrentRecordIcon24.png">.</p>
    <hr>
    <h3><a id="search" name="search"></a>3. Search queries</h3>
    <p>Before executing the search queries they have to be edited in the Search
      query editor filed (found below the list of samples).<br>
    </p>
    <p>Query format (<a title="http://ejdb.org/#queries" href="http://ejdb.org/#queries">http://ejdb.org/#queries</a>):</p>
    <table style="width: 910px; height: 1489px;" border="1">
      <tbody>
        <tr>
          <td>
            <pre><code>/**
 * Create query object.
 * Sucessfully created queries must be destroyed with ejdbquerydel().
 *
 * EJDB queries inspired by MongoDB (mongodb.org) and follows same philosophy.
 *
 *  - Supported queries:
 *      - Simple matching of String OR Number OR Array value:
 *          -   {'fpath' : 'val', ...}
 *      - $not Negate operation.
 *          -   {'fpath' : {'$not' : val}} //Field not equal to val
 *          -   {'fpath' : {'$not' : {'$begin' : prefix}}} //Field not begins with val
 *      - $begin String starts with prefix
 *          -   {'fpath' : {'$begin' : prefix}}
 *      - $gt, $gte (&gt;, &gt;=) and $lt, $lte for number types:
 *          -   {'fpath' : {'$gt' : number}, ...}
 *      - $bt Between for number types:
 *          -   {'fpath' : {'$bt' : [num1, num2]}}
 *      - $in String OR Number OR Array val matches to value in specified array:
 *          -   {'fpath' : {'$in' : [val1, val2, val3]}}
 *      - $nin - Not IN
 *      - $strand String tokens OR String array val matches all tokens in specified array:
 *          -   {'fpath' : {'$strand' : [val1, val2, val3]}}
 *      - $stror String tokens OR String array val matches any token in specified array:
 *          -   {'fpath' : {'$stror' : [val1, val2, val3]}}
 *      - $exists Field existence matching:
 *          -   {'fpath' : {'$exists' : true|false}}
 *      - $icase Case insensitive string matching:
 *          -    {'fpath' : {'$icase' : 'val1'}} //icase matching
 *          Ignore case matching with '$in' operation:
 *          -    {'name' : {'$icase' : {'$in' : ['tHéâtre - &#1090;&#1077;&#1072;&#1090;&#1088;', 'heLLo WorlD']}}}
 *          For case insensitive matching you can create special index of type: `JBIDXISTR`
 *     - $elemMatch The $elemMatch operator matches more than one component within an array element.
 *          -  { array: { $elemMatch: { value1 : 1, value2 : { $gt: 1 } } } }
 *          Restriction: only one $elemMatch allowed in context of one array field.
 *      - $and, $or joining:
 *          -   {..., $and : [subq1, subq2, ...] }
 *          -   {..., $or  : [subq1, subq2, ...] }
 *          Example: {z : 33, $and : [ {$or : [{a : 1}, {b : 2}]}, {$or : [{c : 5}, {d : 7}]} ] }
 *
 *      - Mongodb $(projection) operator supported. (http://docs.mongodb.org/manual/reference/projection/positional/#proj._S_)
 *      - Mongodb positional $ update operator supported. (http://docs.mongodb.org/manual/reference/operator/positional/)
 *
 *
 *  - Queries can be used to update records:
 *       $set Field set operation.
 *           - {.., '$set' : {'field1' : val1, 'fieldN' : valN}}
 *       $upsert Atomic upsert. If matching records are found it will be '$set' operation,
 *              otherwise new record will be inserted with fields specified by argment object.
 *           - {.., '$upsert' : {'field1' : val1, 'fieldN' : valN}}
 *       $inc Increment operation. Only number types are supported.
 *           - {.., '$inc' : {'field1' : number, ...,  'field1' : number}
 *       $dropall In-place record removal operation.
 *           - {.., '$dropall' : true}
 *       $addToSet Atomically adds value to the array only if its not in the array already.
 *                    If containing array is missing it will be created.
 *           - {.., '$addToSet' : {'fpath' : val1, 'fpathN' : valN, ...}}
 *       $addToSetAll Batch version if $addToSet
 *           - {.., '$addToSetAll' : {'fpath' : [array of values to add], ...}}
 *       $pull Atomically removes all occurrences of value from field, if field is an array.
 *           - {.., '$pull' : {'fpath' : val1, 'fpathN' : valN, ...}}
 *       $pullAll Batch version of $pull
 *           - {.., '$pullAll' : {'fpath' : [array of values to remove], ...}}
 *
 *  NOTE: Negate operations: $not and $nin not using indexes
 *  so they can be slow in comparison to other matching operations.
 *
 *  NOTE: Only one index can be used in search query operation.
 *
 *  QUERY HINTS (specified by `hints` argument):
 *      - $max Maximum number in the result set
 *      - $skip Number of skipped results in the result set
 *      - $orderby Sorting order of query fields.
 *      - $fields Set subset of fetched fields
            If a field presented in $orderby clause it will be forced to include in resulting records.
 *          Example:
 *          hints:    {
 *                      "$orderby" : { //ORDER BY field1 ASC, field2 DESC
 *                          "field1" : 1,
 *                          "field2" : -1
 *                      },
 *                      "$fields" : { //SELECT ONLY {_id, field1, field2}
 *                          "field1" : 1,
 *                          "field2" : 1
 *                      }
 *                    }
 *
 * Many query examples can be found in `testejdb/t2.c` test case.
 *
 * @param EJDB database handle.
 * @param qobj Main BSON query object.
 * @param orqobjs Array of additional OR query objects (joined with OR predicate).
 * @param orqobjsnum Number of OR query objects.
 * @param hints BSON object with query hints.
 * @return On success return query handle. On error returns NULL.
 */
EJDB_EXPORT EJQ* ejdbcreatequery(EJDB *jb, bson *qobj, bson *orqobjs, int orqobjsnum, bson *hints);</code></pre>
          </td>
        </tr>
      </tbody>
    </table>
    <p>Query templates can be inserted into the Search query editor, modified
      acordingly and then used for searching the database. To insert query: <span
        style="font-weight: bold;">Record -&gt; Load search query from file...
        -&gt;</span> go to folder /Resources/Templates and chose a template
      file.<br>
      To execute the search query click find, or <span style="font-weight: bold;">Record
        -&gt; Execute search query Find</span> <img style="width: 24px; height: 25px;"
        alt="Find" title="Find" src="img/SelectDisplayRecordIcon24.png">. To
      select all the records in the database delete the search query with <span
        style="font-weight: bold;">Record -&gt; Reset data search query...</span>
      and click find Find <img style="width: 24px; height: 25px;" alt="Find" title="Find"
        src="img/SelectDisplayRecordIcon24.png">.<span style="font-weight: bold;"><br>
      </span></p>
    <p><span style="font-weight: bold;">Example:</span><span style="font-family: Courier New,Courier,monospace;"><br>
      </span></p>
    <p><span style="font-family: Courier New,Courier,monospace;">{<br>
        &nbsp;&nbsp;&nbsp;&nbsp; "expdataset" :&nbsp;&nbsp; {'$in' : ["val1",
        "val2", "val3"]},<br>
        &nbsp;&nbsp;&nbsp;&nbsp; "sample" :&nbsp;&nbsp; {'$in' : ["val1",
        "val2", "val3"]},<br>
        &nbsp;&nbsp;&nbsp;&nbsp; "sT" :&nbsp;&nbsp; {'$bt' : [num1, num2]},<br>
        &nbsp;&nbsp;&nbsp;&nbsp; "sP" :&nbsp;&nbsp; {'$bt' : [num1, num2]}<br>
        }</span></p>
    <p>Search matching expdatasets and samples; with <span style="font-family: Courier New,Courier,monospace;">sT</span>
      and <span style="font-family: Courier New,Courier,monospace;">sP</span>
      in a certain interval; leave out fields that are not necessary in the
      search e.g. <span style="font-family: Courier New,Courier,monospace;">"sT"
        :&nbsp;&nbsp; {'$bt' : [num1, num2]}</span> if no temperature search is
      needed;&nbsp; <span style="font-family: Courier New,Courier,monospace;">'$in'</span>
      - matches the values; <span style="font-family: Courier New,Courier,monospace;">'$bt'</span>
      - between two values;<br>
    </p>
    <p>The result of a a database search can be used in a fitting task by
      inserting in the <a href="gemsfit-input-file.html#DataSelect"><span style="font-family: Courier New,Courier,monospace;">"DataSelect"</span></a>
      the <span style="font-family: Courier New,Courier,monospace;"><a href="gemsfit-input-file.html#samplelist">"samplelist"</a></span>.
      This is automatically done by going in the <span style="font-weight: bold;">Fitting
        Task Mode -&gt; select the task where you want to use the queried record
        list -&gt; Record -&gt; Insert record list into task definition. </span></p>
    <hr>
    <p>Last updated:&nbsp; 15. 05. 2014&nbsp; DM, DK</p>
    <p>Copyright&nbsp; (c) 2014&nbsp; <a target="_blank" title="http://gems.web.psi.ch/teamhist.html"
        href="http://gems.web.psi.ch/teamhist.html">GEMS Development Team</a></p>
    <hr>
    <p><br>
    </p>
  </body>
</html>
